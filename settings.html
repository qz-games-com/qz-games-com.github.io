<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quartz Games | Settings</title>
  <link rel="icon" href="./Q.png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap">
  <link rel="stylesheet" href="./styles/settings.css">
  <link rel="stylesheet" href="./animations.css">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js');
    }
  </script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-J246XWP5WQ"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-J246XWP5WQ');
  </script>
  <script src="./cookieshandle.js"></script>
  <script src="./GlobalSettings.js"></script>
</head>
<body>
  <div class="page-wrapper">
    <header class="top-header">
      <div class="logo">
        <a href="./index.html" class="home-link">
          <span class="material-icons">home</span>
          <span>Home</span>
        </a>
      </div>
      <h1 class="page-title">Settings</h1>
      <button id="mobile-menu-toggle" class="mobile-menu-toggle">
        <span class="material-icons">menu</span>
      </button>
    </header>

    <div class="settings-container">
      <nav class="settings-nav">
        <ul class="nav-list">
          <li><button class="tab-btn active" data-target="main">General</button></li>
          <li><button class="tab-btn" data-target="custom">Performance</button></li>
          <li><button class="tab-btn" data-target="theme">Themes</button></li>
          <!--li><button class="tab-btn" data-target="backgrounds">Backgrounds</button></li-->
        </ul>
      </nav>
      
      <main class="settings-main">
        <section id="main" class="section active">
          <div class="section-header">
            <h2>General Settings</h2>
            <p class="section-description">Configure basic functionality of your Quartz Games experience</p>
          </div>

          <div class="settings-group">
            <div class="toggle-container">
              <div class="toggle-info">
                <span class="toggle-label">Prevent Page Close</span>
                <span class="toggle-description">Show a confirmation before page is closed, prevents unintentional page close attempts (works on goguardian and others).</span>
              </div>
              <label class="toggle-switch">
                <input id="checkprevent" type="checkbox" />
                <span class="slider"></span>
              </label>
            </div>
            
          
            <div class="toggle-container">
              <div class="toggle-info">
                <span class="toggle-label">Sound Effects</span>
                <span class="toggle-description">Enable or disable sound.</span>
              </div>
              <label style="filter: brightness(50%);" class="toggle-switch" >
                <input id="" type="checkbox"  disabled/>
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </section>
        
        <section id="custom" class="section">
          <div class="section-header">
            <h2>Performance Settings</h2>
            <p class="section-description">Customize your performance related settings.</p>
          </div>
          
          <div class="settings-group">
            <div class="toggle-container">
              <div class="toggle-info">
                <span class="toggle-label">Disable Animations</span>
                <span class="toggle-description">Disables page animations, on deviced such as chromebooks this can improve loading times and performance. <br> (does not apply to games and may break some functions of the site) </span>
              </div>
              <label class="toggle-switch">
                <input id="disab" type="checkbox" />
                <span class="slider"></span>
              </label>
            </div>
          </div>

        </section>
        
        <section id="theme" class="section">
          <div class="section-header">
            <h2>Themes</h2>
            <p class="section-description">Choose your preferred theme</p>
          </div>

          <div class="themes-grid">
            <div class="theme-option active" id="classic" data-theme="default">
              <div class="theme-preview">
                <div class="preview-nav"></div>
              </div>
              <div class="theme-info">
                <h3>Classic</h3>
              </div>
            </div>

            <div class="theme-option" id="space" data-theme="space">
              <div class="theme-preview space-theme">
                <div class="preview-nav"></div>
                <div class="space-circle"></div>
              </div>
              <div class="theme-info">
                <h3>Space | Black Hole</h3>
              </div>
            </div>

            <div class="theme-option" id="spaceearth" data-theme="spaceearth">
              <div class="theme-preview space-earth-theme">
                <div class="preview-nav"></div>
                <div class="earth-circle"></div>
              </div>
              <div class="theme-info">
                <h3>Space | Earth</h3>
              </div>
            </div>

            <div class="theme-option" id="midpurp" data-theme="midnight-purple">
              <div class="theme-preview midnight-purple-theme">
                <div class="preview-nav"></div>
              </div>
              <div class="theme-info">
                <h3>Midnight Purple</h3>
              </div>
            </div>

            <div class="theme-option" id="mlg" data-theme="mlg">
              <div class="theme-preview mlg-theme">
                <div class="preview-nav"></div>
              </div>
              <div class="theme-info">
                <h3>MLG</h3>
              </div>
            </div>

            <div class="theme-option" id="mc" data-theme="mc">
              <div class="theme-preview mc-theme">
                <div class="preview-nav"></div>
              </div>
              <div class="theme-info">
                <h3>Minecraft</h3>
              </div>
            </div>

            <div class="theme-option" id="light" data-theme="light">
              <div class="theme-preview light-theme">
                <div class="preview-nav"></div>
              </div>
              <div class="theme-info">
                <h3>Light</h3>
              </div>
            </div>
          </div>
        </section>

        <section id="backgrounds" class="section">
          <div class="section-header">
            <h2>Custom Backgrounds</h2>
            <p class="section-description">Choose dynamic layered backgrounds with parallax effects</p>
          </div>

          <div class="settings-group">
            <div class="toggle-container">
              <div class="toggle-info">
                <span class="toggle-label">Enable Custom Backgrounds</span>
                <span class="toggle-description">Turn on/off the custom background system. When enabled, you can choose from various dynamic layered backgrounds below.</span>
              </div>
              <label class="toggle-switch">
                <input id="customBackgrounds" type="checkbox" />
                <span class="slider"></span>
              </label>
            </div>
          </div>

          <div class="section-header" style="margin-top: 30px;">
            <h3 style="font-size: 1.3em;">Background Themes</h3>
            <p class="section-description">Select a background (independent from color themes)</p>
          </div>

          <div class="themes-grid">
            <div class="theme-option active" id="bg-none" data-background="none">
              <div class="theme-preview">
                <div class="preview-nav"></div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2em; opacity: 0.3;">âˆ…</div>
              </div>
              <div class="theme-info">
                <h3>None</h3>
              </div>
            </div>

            <div class="theme-option" id="bg-mountain" data-background="mountain">
              <div class="theme-preview" style="background: linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 50%, #90EE90 100%);">
                <div class="preview-nav"></div>
                <div style="position: absolute; bottom: 20%; left: 50%; transform: translateX(-50%); width: 80%; height: 30%; background: linear-gradient(to top, #8B7355, #A0826D); clip-path: polygon(0% 100%, 50% 20%, 100% 100%); opacity: 0.7;"></div>
              </div>
              <div class="theme-info">
                <h3>Mountain Scene</h3>
              </div>
            </div>

            <div class="theme-option" id="bg-space" data-background="space">
              <div class="theme-preview" style="background: radial-gradient(circle at 30% 30%, #1a1a2e, #0f0f1e);">
                <div class="preview-nav"></div>
                <div style="position: absolute; top: 30%; left: 30%; width: 30px; height: 30px; background: radial-gradient(circle, #4a69bd, #0c2461); border-radius: 50%;"></div>
                <div style="position: absolute; top: 20%; left: 60%; width: 3px; height: 3px; background: white; border-radius: 50%; box-shadow: 0 0 5px white;"></div>
                <div style="position: absolute; top: 70%; left: 20%; width: 2px; height: 2px; background: white; border-radius: 50%;"></div>
                <div style="position: absolute; top: 50%; left: 80%; width: 2px; height: 2px; background: white; border-radius: 50%;"></div>
              </div>
              <div class="theme-info">
                <h3>Space</h3>
              </div>
            </div>

            <div class="theme-option" id="bg-forest" data-background="forest">
              <div class="theme-preview" style="background: linear-gradient(to bottom, #4A90E2 0%, #7EC8E3 30%, #228B22 100%);">
                <div class="preview-nav"></div>
                <div style="position: absolute; bottom: 10%; left: 20%; width: 15%; height: 40%; background: linear-gradient(to top, #2d5016, #4a7c2f); clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
                <div style="position: absolute; bottom: 10%; right: 20%; width: 15%; height: 35%; background: linear-gradient(to top, #2d5016, #4a7c2f); clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div>
              </div>
              <div class="theme-info">
                <h3>Forest</h3>
              </div>
            </div>

            <div class="theme-option" id="bg-ocean" data-background="ocean">
              <div class="theme-preview" style="background: linear-gradient(to bottom, #87CEEB 0%, #4A90E2 50%, #1E3A8A 100%);">
                <div class="preview-nav"></div>
                <div style="position: absolute; top: 60%; left: 0; width: 100%; height: 3px; background: rgba(255,255,255,0.3);"></div>
                <div style="position: absolute; top: 75%; left: 0; width: 100%; height: 2px; background: rgba(255,255,255,0.2);"></div>
              </div>
              <div class="theme-info">
                <h3>Ocean</h3>
              </div>
            </div>

            <div class="theme-option" id="bg-desert" data-background="desert">
              <div class="theme-preview" style="background: linear-gradient(to bottom, #FFB347 0%, #FFCC80 50%, #DEB887 100%);">
                <div class="preview-nav"></div>
                <div style="position: absolute; bottom: 20%; left: 30%; width: 40%; height: 25%; background: linear-gradient(to top, #C19A6B, #D2B48C); clip-path: polygon(0% 100%, 20% 50%, 40% 70%, 60% 40%, 80% 60%, 100% 100%);"></div>
              </div>
              <div class="theme-info">
                <h3>Desert</h3>
              </div>
            </div>

            <div class="theme-option" id="bg-city" data-background="city">
              <div class="theme-preview" style="background: linear-gradient(to bottom, #2C3E50 0%, #34495E 50%, #1C2833 100%);">
                <div class="preview-nav"></div>
                <div style="position: absolute; bottom: 30%; left: 20%; width: 10%; height: 30%; background: #34495E; border: 1px solid #5D6D7E;"></div>
                <div style="position: absolute; bottom: 30%; left: 35%; width: 8%; height: 40%; background: #34495E; border: 1px solid #5D6D7E;"></div>
                <div style="position: absolute; bottom: 30%; right: 25%; width: 12%; height: 35%; background: #34495E; border: 1px solid #5D6D7E;"></div>
              </div>
              <div class="theme-info">
                <h3>City</h3>
              </div>
            </div>

            <div class="theme-option" id="bg-abstract" data-background="abstract">
              <div class="theme-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);">
                <div class="preview-nav"></div>
                <div style="position: absolute; top: 30%; left: 20%; width: 30%; height: 30%; background: radial-gradient(circle, rgba(255,255,255,0.2), transparent); border-radius: 50%;"></div>
                <div style="position: absolute; bottom: 20%; right: 20%; width: 40%; height: 40%; background: radial-gradient(circle, rgba(0,0,0,0.2), transparent); border-radius: 50%;"></div>
              </div>
              <div class="theme-info">
                <h3>Abstract</h3>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
  // Tab switching functionality
  const tabButtons = document.querySelectorAll('.tab-btn');
  const sections = document.querySelectorAll('.section');
  
  tabButtons.forEach(button => {
    button.addEventListener('click', () => {
      // Remove active class from all buttons and sections
      tabButtons.forEach(btn => btn.classList.remove('active'));
      sections.forEach(section => section.classList.remove('active'));
      
      // Add active class to clicked button and corresponding section
      button.classList.add('active');
      const target = button.getAttribute('data-target');
      document.getElementById(target).classList.add('active');
    });
  });
  
  // Theme selection functionality
  const themeOptions = document.querySelectorAll('.theme-option');
  
  themeOptions.forEach(option => {
    option.addEventListener('click', () => {
      themeOptions.forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');
      
      // Get selected theme type
      const selectedTheme = option.getAttribute('data-theme');
      
      // Save theme preference to localStorage
      setCookie('theme', selectedTheme);
      
      // Apply theme (this would connect to your theme system)
      applyTheme(selectedTheme);
    });
  });
  
  // Mobile menu toggle functionality
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const navMenu = document.querySelector('.settings-nav');
  
  if (mobileMenuToggle) {
    mobileMenuToggle.addEventListener('click', () => {
      navMenu.classList.toggle('show');
      
      // Change menu icon based on state
      const menuIcon = mobileMenuToggle.querySelector('.material-icons');
      if (navMenu.classList.contains('show')) {
        menuIcon.textContent = 'close';
      } else {
        menuIcon.textContent = 'menu';
      }
    });
  }
  
  // Range slider functionality
  const interfaceSlider = document.getElementById('interface-size');
  const rangeValue = document.querySelector('.range-value');
  
  if (interfaceSlider && rangeValue) {
    interfaceSlider.addEventListener('input', () => {
      rangeValue.textContent = `${interfaceSlider.value}%`;
    });
  }
  
  // Prevent page close functionality
  const preventPageClose = document.getElementById('checkprevent');
  
  if (preventPageClose) {
    // Load saved preference
    preventPageClose.checked = getCookie('preventPageClose') === 'true';
    
    preventPageClose.addEventListener('change', () => {
      setCookie('preventPageClose', preventPageClose.checked);
      
      if (preventPageClose.checked) {
        enablePreventPageClose();
      } else {
        disablePreventPageClose();
      }
    });
    
    // Initialize state based on saved preference
    if (preventPageClose.checked) {
      enablePreventPageClose();
    }
  }
  
  // Load and initialize all saved preferences
  loadSavedPreferences();
});

// Apply selected theme
function applyTheme(theme) {
  console.log(`Theme applied: ${theme}`);
  // This would connect to your existing theme system
  // For example:
  // document.body.setAttribute('data-theme', theme);
}

// Apply selected background (independent from theme)
function applyBackground(background) {
  console.log(`Background applied: ${background}`);
  // This message is shown in settings page
  // The actual background loading happens in index.html via loadSelectedBackground()
}

// Prevent page close functionality
function enablePreventPageClose() {
  window.addEventListener('beforeunload', handleBeforeUnload);
}

function disablePreventPageClose() {
  window.removeEventListener('beforeunload', handleBeforeUnload);
}

function handleBeforeUnload(event) {
  event.preventDefault();
  event.returnValue = '';
  return '';
}

// Load all saved preferences
// Apply interface size scaling
function applyInterfaceSize(size) {
  // This sets a CSS variable that could be used to scale UI elements
  document.documentElement.style.setProperty('--ui-scale', `${size / 100}`);
  console.log(`Interface size set to ${size}%`);
}

// Responsive behavior when window is resized
window.addEventListener('resize', handleWindowResize);

function handleWindowResize() {
  const isMobile = window.innerWidth <= 768;
  const navMenu = document.querySelector('.settings-nav');
  
  if (!isMobile && navMenu) {
    // Always show nav on desktop/tablet
    navMenu.classList.remove('show');
    
    // Reset menu icon
    const menuIcon = document.querySelector('.mobile-menu-toggle .material-icons');
    if (menuIcon) {
      menuIcon.textContent = 'menu';
    }
  }
}

function loadSavedPreferences() {
  // Load theme preference
  const savedTheme =getCookie('theme');
  if (savedTheme) {
    const themeElement = document.querySelector(`[data-theme="${savedTheme}"]`);
    if (themeElement) {
      themeElement.click();
    }
  }
  
  // Load notification preference
  const disab = document.getElementById('disab');
  
  if (disab) {
    // Load saved preference
    disab.checked = getCookie('disableAnimations') === 'true';
    
    disab.addEventListener('change', () => {
      setCookie('disableAnimations', disab.checked);
      console.log(getCookie('disableAnimations'))
    });

  }

  // Load custom backgrounds preference
  const customBackgrounds = document.getElementById('customBackgrounds');

  if (customBackgrounds) {
    // Load saved preference
    customBackgrounds.checked = getCookie('customBackgrounds') !== 'false'; // default to true

    customBackgrounds.addEventListener('change', () => {
      setCookie('customBackgrounds', customBackgrounds.checked);
      console.log('Custom Backgrounds:', customBackgrounds.checked);
    });
  }

  // Background selection functionality (separate from themes)
  const backgroundOptions = document.querySelectorAll('[data-background]');

  // Load saved background preference
  const savedBackground = getCookie('selectedBackground') || 'none';
  backgroundOptions.forEach(option => {
    if (option.getAttribute('data-background') === savedBackground) {
      option.classList.add('active');
    } else {
      option.classList.remove('active');
    }
  });

  backgroundOptions.forEach(option => {
    option.addEventListener('click', () => {
      // Remove active class from all background options
      backgroundOptions.forEach(opt => opt.classList.remove('active'));

      // Add active class to clicked option
      option.classList.add('active');

      // Get selected background type
      const selectedBackground = option.getAttribute('data-background');

      // Save background preference to cookie
      setCookie('selectedBackground', selectedBackground);

      console.log('Background selected:', selectedBackground);

      // Apply background if enabled
      if (customBackgrounds && customBackgrounds.checked) {
        applyBackground(selectedBackground);
      }
    });
  });

  // Load sound effects preference
  const soundEffectsToggle = document.getElementById('soundeffects');
  if (soundEffectsToggle) {
    const savedSoundEffects = localStorage.getItem('enableSoundEffects');
    soundEffectsToggle.checked = savedSoundEffects === null ? true : savedSoundEffects === 'true';
    
    soundEffectsToggle.addEventListener('change', () => {
      localStorage.setItem('enableSoundEffects', soundEffectsToggle.checked);
    });
  }

  
  // Handle interface size if available
  const interfaceSizeSlider = document.getElementById('interface-size');
  if (interfaceSizeSlider) {
    const savedSize = localStorage.getItem('interfaceSize');
    if (savedSize) {
      interfaceSizeSlider.value = savedSize;
      document.querySelector('.range-value').textContent = `${savedSize}%`;
      applyInterfaceSize(savedSize);
    }
    
    interfaceSizeSlider.addEventListener('change', () => {
      const newSize = interfaceSizeSlider.value;
      localStorage.setItem('interfaceSize', newSize);
      applyInterfaceSize(newSize);
    });
  }
}
  </script>
</body>
</html>